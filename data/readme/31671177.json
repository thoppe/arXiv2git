{
  "read_at": 1462544905, 
  "description": "Qualitative Activity Recognition of Weight Lifting Exercises - Practical Machine Learning - Coursera", 
  "README.md": "# Qualitative Activity Recognition of Weight Lifting Exercises\n\n## Background\nUsing devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement - a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. \n\nIn this project, we will use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways:\n\n+ Class A: exactly according to the specification\n+ Class B: throwing the elbows to the front\n+ Class C: lifting the dumbbell only halfway\n+ Class D: lowering the dumbbell only halfway\n+ Class E: throwing the hips to the front\n\nMore information is available from the website here: http://groupware.les.inf.puc-rio.br/har (see the section on the Weight Lifting Exercise Dataset).\n\n## Goal\nThe goal of this project of the Coursera Practical Machine Learning course is to predict the manner in which people did the exercise. This is the \"classe\" variable in the training set.\n\n## Report\nThis report describes:\n+ how this model is built; \n+ how cross validation is used;\n+ what the expected out of sample error is;\n+ justification of the made choices;\n+ Results of prediction model predicting 20 different test cases. \n\n### Reproducibility\nWe set the work dir and start with loading the required libraries. For futher reproducibility, we will set seeds before we create different models.\n\n    # set work dir\n    setwd(\"C:/Users/mdragt/SkyDrive/Coursera/ML\")\n    \n    # load libraries\n    library(caret)\n    library(randomForest)\n    library(rpart)\n    library(rpart.plot)\n    library(ggplot2)\n    library(lattice)\n    library(rattle)\n\n### Getting the data\nWe Load the training and test data sets. We wil use the test set for the final validation\n\n    # read training and testing data for coursera course. \n    trainUrl <- \"http://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv\"\n    valUrl <- \"http://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv\"\n    data <- read.csv(url(trainUrl), header=TRUE, sep=\",\", na.strings=c(\"NA\",\"#DIV/0!\",\"\"))\n    validation <- read.csv(url(valUrl), header=TRUE, sep=\",\", na.strings=c(\"NA\",\"#DIV/0!\",\"\"))\n\n### Cleaning and preparing the data\nIn this section, we will inspect, clean and prepare the data for further processing.\n\n**Inspect the data**\nWe notice that the first columns don't contain usefull data and that there are many variables with missing data. Besides,some of the variables, like stddev_, avg_, kurtosis_ etc. seem to be derived from the original data. We will exclude them in the next step. Please notice that although the amount of columns of both training and validation set is equal, the last column of the validation set is different (problem_id) in comparison to the last column of the training set (classe). Make sure that you apply the same transformations on both your training and validation set.\n\n    summary(data)\n    summary(validation)\n    dim(data)\n    dim(validation)\n\n**Remove unnecessary columns**\n\n    # first 7 columns don't contain useful info\n    data <- data[,-seq(1:7)]\n    validation <- validation[,-seq(1:7)]\n\n**Remove columns with NAs**\nThis reduces de amount of predictors to 53\n\n    # select columns that don't have NAs\n    indexNA <- as.vector(sapply(data[,1:152],function(x) {length(which(is.na(x)))!=0}))\n    data <- data[,!indexNA]\n    validation <- validation[,!indexNA]\n\n**Remove highly correlated variables**\nHighly correlated variables can sometimes reduce the performance of a model, and will be excluded. However, this way of selection is disputable: http://arxiv.org/abs/1310.5726\n\n    # set last (classe) and prior (- classe) column index\n    last <- as.numeric(ncol(data))\n    prior <- last - 1\n    \n    # set variables to numerics for correlation check, except the \"classe\"\n    for (i in 1:prior) {\n    data[,i] <- as.numeric(data[,i])\n    validation[,i] <- as.numeric(validation[,i])\n    }\n    \n    # check the correlations\n    cor.check <- cor(data[, -c(last)])\n    diag(cor.check) <- 0 \n    plot( levelplot(cor.check, \n                    main =\"Correlation matrix for all WLE features in training set\",\n                    scales=list(x=list(rot=90), cex=1.0),))\n                    \n![Correlation Matrix](/Images/CorMatrix.jpeg)\n\n    # find the highly correlated variables\n    highly.cor <- findCorrelation(cor(data[, -c(last)]), cutoff=0.9)\n    \n    # remove highly correlated variables\n    data <- data[, -highly.cor]\n    validation <- validation[, -highly.cor]\n\n**Preproccesing of the variables**\nThe amount of predictors is now 46. We will continue with the preproccing of these predictors, by centering and scaling them. Remember that the last column of the validation set contained the problem_id.\n\n    # pre process variables\n    preObj <-preProcess(data[,1:prior],method=c('knnImpute', 'center', 'scale'))\n    dataPrep <- predict(preObj, data[,1:prior])\n    dataPrep$classe <- data$classe\n    \n    valPrep <-predict(preObj,validation[,1:prior])\n    valPrep$problem_id <- validation$problem_id\n\n**Remove the near zero variables**\nNear zero variables have less prediction value, so we remove them. Although in this case, there are none to be elimnated.\n\n    # test near zero variance\n    myDataNZV <- nearZeroVar(dataPrep, saveMetrics=TRUE)\n    if (any(myDataNZV$nzv)) nzv else message(\"No variables with near zero variance\")\n    dataPrep <- dataPrep[,myDataNZV$nzv==FALSE]\n    valPrep <- valPrep[,myDataNZV$nzv==FALSE]\n\n### Create a cross validation set\nTo train and test the model, we create a training and a testing set.\n\n    # split dataset into training and test set\n    inTrain <- createDataPartition(y=dataPrep$classe, p=0.7, list=FALSE )\n    training <- dataPrep[inTrain,]\n    testing <- dataPrep[-inTrain,]\n\n### Train Model 1: Random Forest\nRegarding the data, we will expect Decision Tree and Random Forest to give the best results. We start with Random Forest. First we set a seed to make this project reproducable. We will use the tuneRF function to calculate the optimal mtry and use that in the random forest function.\n   \n    # set seed for reproducibility\n    set.seed(12345)\n\n    # get the best mtry\n    bestmtry <- tuneRF(training[-last],training$classe, ntreeTry=100, \n                       stepFactor=1.5,improve=0.01, trace=TRUE, plot=TRUE, dobest=FALSE)\n    \n    mtry <- bestmtry[as.numeric(which.min(bestmtry[,\"OOBError\"])),\"mtry\"]\n  \n    # Model 1: RandomForest\n    wle.rf <-randomForest(classe~.,data=training, mtry=mtry, ntree=501, \n                          keep.forest=TRUE, proximity=TRUE, \n                          importance=TRUE,test=testing)\n    \n\n### Results of Model 1\nFirst we plot the Out-Of-Bag (OOB) error-rate. Besides, we will investigate the mean decrease of both accuracy and Gini score. As we can see it was correct to use 501 trees. \n\n    # plot the Out of bag error estimates\n    layout(matrix(c(1,2),nrow=1), width=c(4,1)) \n    par(mar=c(5,4,4,0)) #No margin on the right side\n    plot(wle.rf, log=\"y\", main =\"Out-of-bag (OOB) error estimate per Number of Trees\")\n    par(mar=c(5,0,4,2)) #No margin on the left side\n    plot(c(0,1),type=\"n\", axes=F, xlab=\"\", ylab=\"\")\n    legend(\"top\", colnames(wle.rf$err.rate),col=1:6,cex=0.8,fill=1:6)\n\n![Out of bag error rate](/Images/OOB.jpeg)\n\n    # plot the accuracy and Gini\n    varImpPlot(wle.rf, main=\"Mean Decrease of Accuracy and Gini per variable\")\n\n![Accuracy and Gini scores](/Images/AccuracyGini.jpeg)\n    \n    # MDSplot (we couldn't execute this due to lack of memory)\n    MDSplot(wle.rf, training$classe)\n\n### Accuracy Model 1 on training set and cross validation set\nHere we use Model 1 to predict both the training as the testing set. With the test set, we obtain an accuracy of 0.9951, which seems to be acceptable. However, we will also test the Decision Tree model.\n\n    # results with training set\n    predict1 <- predict(wle.rf, newdata=training)\n    confusionMatrix(predict1,training$classe)\n    \n    Confusion Matrix and Statistics\n\n    #              Reference\n    # Prediction    A    B    C    D    E\n    #          A 3906    0    0    0    0\n    #          B    0 2658    0    0    0\n    #          C    0    0 2396    0    0\n    #          D    0    0    0 2252    0\n    #          E    0    0    0    0 2525\n    \n    # Overall Statistics\n                                     \n    #            Accuracy : 1          \n    #              95% CI : (0.9997, 1)\n    # No Information Rate : 0.2843     \n    # P-Value [Acc > NIR] : < 2.2e-16  \n                                     \n    #               Kappa : 1          \n    # Mcnemar's Test P-Value : NA         \n\n    # Statistics by Class:\n\n    #                      Class: A Class: B Class: C Class: D Class: E\n    # Sensitivity            1.0000   1.0000   1.0000   1.0000   1.0000\n    # Specificity            1.0000   1.0000   1.0000   1.0000   1.0000\n    # Pos Pred Value         1.0000   1.0000   1.0000   1.0000   1.0000\n    # Neg Pred Value         1.0000   1.0000   1.0000   1.0000   1.0000\n    # Prevalence             0.2843   0.1935   0.1744   0.1639   0.1838\n    # Detection Rate         0.2843   0.1935   0.1744   0.1639   0.1838\n    # Detection Prevalence   0.2843   0.1935   0.1744   0.1639   0.1838\n    # Balanced Accuracy      1.0000   1.0000   1.0000   1.0000   1.0000\n\n    # results with test set\n    predict2 <- predict(wle.rf, newdata=testing)\n    confusionMatrix(predict2,testing$classe)\n    \n    # Confusion Matrix and Statistics\n\n    #               Reference\n    # Prediction    A    B    C    D    E\n    #         A 1671    2    0    0    0\n    #         B    2 1134   11    0    0\n    #         C    0    3 1015    9    0\n    #         D    0    0    0  954    0\n    #         E    1    0    0    1 1082\n\n    # Overall Statistics\n                                          \n    #             Accuracy : 0.9951          \n    #               95% CI : (0.9929, 0.9967)\n    #  No Information Rate : 0.2845          \n    #  P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n    #                Kappa : 0.9938          \n    #  Mcnemar's Test P-Value : NA              \n\n    # Statistics by Class:\n\n    #                      Class: A Class: B Class: C Class: D Class: E\n    # Sensitivity            0.9982   0.9956   0.9893   0.9896   1.0000\n    # Specificity            0.9995   0.9973   0.9975   1.0000   0.9996\n    # Pos Pred Value         0.9988   0.9887   0.9883   1.0000   0.9982\n    # Neg Pred Value         0.9993   0.9989   0.9977   0.9980   1.0000\n    # Prevalence             0.2845   0.1935   0.1743   0.1638   0.1839\n    # Detection Rate         0.2839   0.1927   0.1725   0.1621   0.1839\n    # Detection Prevalence   0.2843   0.1949   0.1745   0.1621   0.1842\n    # Balanced Accuracy      0.9989   0.9964   0.9934   0.9948   0.9998\n\n    \n### Train Model 2: Decision Tree\n\n    # Model 2: Decision Tree\n    dt <- rpart(classe ~ ., data=training, method=\"class\")\n    \n    # fancyRpartPlot works for small trees, but not for ours\n    fancyRpartPlot(dt)\n\n![Decision Tree Plot](/Images/fancyPlot.jpeg)\n    \n### Accuracy Model 2 on training set and cross validation set\nAs we can see, this model is not improving the performance, having an accuracy of 0.6989. Therefor, we will continue with model 1.\n\n    # cross validation\n    predictDT <- predict(dt, testing, type = \"class\")\n    confusionMatrix(predictDT, testing$classe)\n    \n    # Confusion Matrix and Statistics\n\n    #               Reference\n    #  Prediction    A    B    C    D    E\n    #           A 1506  190   51   67   49\n    #           B   53  616   59   92  184\n    #           C   44  199  867  180  242\n    #           D   67  114   46  616   99\n    #           E    4   20    3    9  508\n\n    # Overall Statistics\n                                         \n    #             Accuracy : 0.6989         \n    #               95% CI : (0.687, 0.7106)\n    #  No Information Rate : 0.2845         \n    #  P-Value [Acc > NIR] : < 2.2e-16      \n                                         \n    #                Kappa : 0.618          \n    # Mcnemar's Test P-Value : < 2.2e-16      \n\n    # Statistics by Class:\n\n    #                      Class: A Class: B Class: C Class: D Class: E\n    # Sensitivity            0.8996   0.5408   0.8450   0.6390  0.46950\n    # Specificity            0.9152   0.9182   0.8631   0.9338  0.99250\n    # Pos Pred Value         0.8084   0.6135   0.5659   0.6539  0.93382\n    # Neg Pred Value         0.9582   0.8928   0.9635   0.9296  0.89253\n    # Prevalence             0.2845   0.1935   0.1743   0.1638  0.18386\n    # Detection Rate         0.2559   0.1047   0.1473   0.1047  0.08632\n    # Detection Prevalence   0.3166   0.1706   0.2603   0.1601  0.09244\n    # Balanced Accuracy      0.9074   0.7295   0.8541   0.7864  0.73100\n    \n\n### Results\nFinally, as the Random Forest model gave us the best result, we will apply that to our validation set and create the documents to submit.\n\n    # Predict the class of the validation set\n    answer<-predict(wle.rf,valPrep)\n    answer\n    \n    # code as suggested by Coursera\n    pml_write_files = function(x){\n        n = length(x)\n        for(i in 1:n){\n            filename = paste0(\"problem_id_\",i,\".txt\")\n            write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)\n        }\n    }\n    \n    pml_write_files(answer)\n\n## Data \nThe training data for this project are available here: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv\n\nThe test data are available here: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv\n\nThe data for this project come from this source: http://groupware.les.inf.puc-rio.br/har. \n\nRead more: http://groupware.les.inf.puc-rio.br/har#ixzz3TROgwbfY\n\nVelloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human '13) . Stuttgart, Germany: ACM SIGCHI, 2013. \n\n## Notes\nThis project is an assignment for the Coursera Practical Machine Learning course\n", 
  "id": 31671177
}