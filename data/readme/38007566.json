{
  "read_at": 1462549316, 
  "description": "Benchmarks of artificial neural network library for Spark MLlib", 
  "README.md": "# ann-benchmark\nBenchmarks of artificial neural network implementation for \n  - Spark MultilayerPerceptron https://github.com/apache/spark\n  - Old version for Spark MLlib https://github.com/avulanov/spark/tree/ann-interface-gemm. \n\n## Introduction\nThe goal is to benchmark the library, compare it with the other tools and test scalability with the number of nodes in the cluster.\n  - Dataset: \n    - MNIST handwritten digits http://yann.lecun.com/exdb/mnist/\n    - 60000 training set, 10000 test set \n    - Format: depends on the tool\n  - Network: \n    - 6-layer NN 784-2500-2000-1500-1000-500-10 http://arxiv.org/pdf/1003.0358v1.pdf\n    - ~12M weights total\n  - Metrics:\n    - Time needed for one epoch including gradient update \n\nThe intention is to test a big model. Data is small so the time needed to read the data can be ignored. \n\n## Prerequisites\n### GCC 4.8.2\nRedHat 6.x has an older GCC compiler that has libgfortran library that is incompatible with netlib-java wrappers. Check GCC version: `gcc -v`. New GCC should be ALWAYS in your path:\n```\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/new/gcc/lib64\n```\n\n### OpenBLAS\n  - Download, compile and install OpenBLAS https://github.com/xianyi/OpenBLAS\n  - Add OpenBLAS to your library path:\n```\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/your/openblas\n```\n  - Create symlink to OpenBLAS within its folder\n```\nln -s libopenblas.so libblas.so.3\n```\n  - To use OpenBLAS, add it to your library path. Make sure there is no other folder with `libblas.so.3` in your path.\n```\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/your/openblas\n```\n### CUDA and NVBLAS (for GPU)\n  - Download and install the latest CUDA and GPU driver (usually comes with CUDA)\n  - NB! you need the reference CBLAS library to run NVBLAS through Spark\n    - RedHat and Fedora\n      - Download and compile CBLAS as a shared library: http://avulanov.blogspot.com/2015/03/cblas-compilation-as-shared-library.html\n      - Create symlink to CBLAS within its folder\n`ln -s cblas_LINUX.so libblas.so.3`\n    - Ubuntu etc. `sudo apt-get install blas`\n      - Make sure that the installed library has CBLAS symbols `objdump -T libblas.so.3 | grep \"cblas\"`\n  - NVBLAS needs configuration file to run\n    - Create `nvblas.conf` file within `/your/cuda/lib64`. Copy the contents from: http://docs.nvidia.com/cuda/nvblas/#NVBLAS_CONFIG_FILE. Modify the log path within the file.\n    - Add a variable\n```\nexport NVBLAS_CONFIG_FILE=/your/cuda/lib64/nvblas.conf\n```\n  - To use NVBLAS, add CBLAS and CUDA to your library path. Also, preload NVBLAS symbols (it is better to do this right before launching Spark otherwise all your shell commands will go through NVBLAS causing errors). Make sure there is no other folder with `libblas.so.3` in your path.\n```\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/your/cblas:/your/cuda/lib64\nexport LD_PRELOAD=/your/cuda/lib64/libnvblas.so\n```\n## Benchmark\n### Spark\n  - Clone Spark from \n    - https://github.com/apache/spark or\n    - https://github.com/avulanov/spark/tree/ann-interface-gemm\n  - Compile Spark with `-Pnetlib-lgpl` flag to use native BLAS\n  - Deploy Spark on N-node cluster\n  - Download and unzip mnist dataset: http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/mnist.scale.bz2 \n  - Run the benchmark using the provided scala code:\n    - spark-latest.scala or spark.scala\n\n### Caffe\n  - Download Caffe\n  - Configure `Makefile.config` to point to the same OpenBLAS lib (and CUDA) as for Spark\n  - Change Solver to Double precision `tools/caffe.cpp`:\n```\n sed -i \"s/float/double/g\" caffe.cpp\n```\n  - Compile Caffe\n  - Set environment variable:\n```    \nexport $CAFFE=/your/caffe/\n```\n  - Download mnist dataset and convert it to lmdb: \n```\n$CAFFE/data/mnist/get_mnist.sh\n$CAFFE/examples/mnist/create_mnist.sh\n```\n  - Run the benchmark with the model provided:\n```\n$CAFFE/build/tools/caffe train --solver=mnist-lmdb-5h.solver\n```\n## Benchmark\n  - Hardware/Software setup:\n    - Intel(R) Xeon(R) CPU E31240 @ 3.30GHz, 16GB RAM \n    - RedHat 6.4, OpenBLAS\n    - Total 6 machines\n    - Spark: one master, 5 workers\n\nPreliminary results (s):\n\nNodes\t| ANN-total\t| ANN-compute\t| Caffe\t| Caffe60K |\n------|-----------|-------------|-------|----------|\n5 |\t29 |\t21 |\t62 | 56 |\n4\t| 27 |\t24\t| 62\t| 56 |\n3 |\t35.2 |\t33 |\t62 |\t56 |\n2\t| 47 |\t44\t| 62\t| 56 |\n1\t| 86\t| 84\t| 62\t| 56 |\n\nThe lastest results are in the spreadsheet: https://docs.google.com/spreadsheets/d/13U1fwF5-h90X-VeF01dOT-IlJtwYa1AsRtCBjAkSqKI/edit?usp=sharing\n\n", 
  "id": 38007566
}