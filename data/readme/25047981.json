{
  "read_at": 1462511217, 
  "description": "Clojure client for opencpu", 
  "README.md": "# opencpu-clj\n\nA Clojure library designed to use the [OpenCPU](http://opencpu.org) API from Clojure.\n\n## Usage\n\nThe purpose of this library is to allow Clojure applications to call arbitrary R functions and access data from R packages via a remote opencpu server.\nFor the current list of supported API methods see [here] (doc/endpoints.md)\n\nTo use this library, just add\n\n````Clojure\n[opencpu-clj \"0.1.0\"]\n````\nto you project.clj\n\n\n### Low level API\n\nThe low-level package contains four methods, which match the names of the API endpoints:\n\n- object\n- library\n- package\n- session\n\n\n#### Low-level general call of an R function\nTo call R, there are low-level methods (in ocpu.clj), which just call the OpenCPU endpoints.\nThey require parameter to be encoded in JSON or to be the keys coming from previous calls.\nThe parameters must be named always.\n\n\nA general call to an R method looks like this:\n````Clojure\n(object \"http://public.opencpu.org\" :library \"stats\" :R \"rnorm\" {:n 10})\n=> {:result [\"/ocpu/tmp/x047c97a725/R/.val\" \"/ocpu/tmp/x047c97a725/stdout\" \"/ocpu/tmp/x047c97a725/source\" \"/ocpu/tmp/x047c97a725/console\" \"/ocpu/tmp/x047c97a725/info\" \"/ocpu/tmp/x047c97a725/files/DESCRIPTION\"], :status 201}\n1f6261fc3/info\" \"/ocpu/tmp/x01f6261fc3/files/DESCRIPTION\"]\n(session \"http://public.opencpu.org\" \"/ocpu/tmp/x047c97a725/R/.val\" :json )\n=>{:result (1.0304 -1.2131 1.1241 -0.2802 0.0636 -0.2377 0.8318 1.5895 1.9314 0.2717), :status 200}\n````\nThis calls the R function \"rnorm\" from package \"stats\" with parameter (n=10) on the OpenCPU server at url \"http://public.opencpu.org\".\n\nIt returns a session key. (In the form of a list of session key links).\nFurther data of the call result can be obtained by accessing the different links via the \"session\" method.\n\nThese links give access to different data from the call, like:\n\n- the result of the call\n- the stdout of the call\n- the parameters the function was called with\n- the sessionInfo() of the call\n...\n\nSo to access the return value of a function, two calls are required.\n\n#### Low-level call of R function - JSON-RPC style\n\nAn example usage to call R function \"seq\", with named parameters \"from\" and \"to\".\nIt gets called in \"json-rpc style\", so returns Json, which gets coerced to a Clojure data structure (in this case a vector)\n\nAttention: This is not possible to do with all R functions. Most function results cannot be converted to Json by the OpenCPU server,\n and some json coming back cannot be converted to a Clojure datastructure.\n\nSo in contrary to the \"general\" style, which always succeeds (given the parameter are ok, so R can do the call successfully),\n the Json style might fail to marshall the result back from the server.\n\nSo the following will work, because the \"seq\" function returns a vector of numeric type, which can be marshalled to Json by R and unnmarshelled by Clojure.\n\n````Clojure\n(object \"http://public.opencpu.org\" :library \"base\" :R \"seq\" {:from 1 :to 5} :json)\n=>{:result (1 2 3 4 5), :status 200}\n````\n\nTo call the \"lm\" method like this, will fail, as it returns the R class \"lm\", which cannot be marshalled to Json by the JSONlite library used by the opencpu server.\n````Clojure\n(object server-url :library \"stats\" :R \"lm\" {:formula \"dist ~ speed\" :data \"cars\"} :json)\n=> {:result \"No method asJSON S3 class: lm\\n\", :status 400}\n````\nSo this method can only be called without :json. And the resulting session objects can then be used as parameters in further calls.\n\n\nAn other example is some matrix calculations done in R:\n\n````Clojure\n(def m (m/matrix [[13 2][5 4]]))\n(object \"http://public.opencpu.org\" :library \"base\" :R \"eigen\" {:x (json/write-str m)} :json)\n=> {:result {:values [14 3], :vectors [[0.8944 -0.1961] [0.4472 0.9806]]}, :status 200}\n````\n\n#### Parameter format for function calls\nThe \"parameter\" map passed to the 'object' need to have the values either as:\n\n- valid R expressions\n- session keys\n- Json syntax.\n\nSee the tests in ocpu_test.clj for examples.\n\n##### Json Syntax\nJson encoded parameters need to be in a Json format which is understood by the R function jsonlite::fromJSON and get converted in the correct R type.\nSo the \"params\" parameter of function 'object' is a map from Keywords to (Json-encoded) Strings, like\n\n````Clojure\n{:a 10   b: [1 2 3 4 5]   c: \"[\\\"a\\\",\\\"b\\\",\\\"c\\\"]}\n````\n\n\nExamples:\n\n R type         | R code                            | Clojure Type        | Json representation as Clojure String literal\n----------------|-----------------------------------|-------------------- |-----------------------\n                |                                   |primitive            | 1  or \"1\"\n numeric vector |                                   |integer vector       | \"[1,2,3]\"\n char vector    |                                   |String vector        | \"[\\\"a\\\",\\\"b\\\",\\\"c\\\"\n matrix         | matrix(1:4,nrow=2)                |                     | \"[[1,3],[2,4]]\n dataframe      | data.frame(x=c(1,2),y=c(\"a\",\"b\")  |                     | \"[{\\\"x\\\":1,\\\"y\\\":\\\"a\\\"},{\\\"x\\\":2,\\\"y\\\":\\\"b\\\"}]\"\n list           | list(1,2)                         |                     | \"[[1],[2]]\"\n named list     | list(a=1,b=2)                     |                     | \"{\\\"a\\\":[1],\\\"b\\\":[2]} \"\n\n\nSee here for further information: http://arxiv.org/pdf/1403.2805v1.pdf\n\nThe return values for the R function calls via 'object' which requests \"json\" as output format, get encoded appropriately.\nSo the function 'object' returns a Json encoded value following the upper encodings\n\n### High level API\n\n#### Calling an R function\n\n#### Evaluating an R expression\n\n\n#### Accessing data from an R package\n\nTo access a dataset from inside an R package, the get-dataset method can be used like this.\n````Clojure\n(get-dataset \"https://public.opencpu.org\" \"MASS\" \"Boston\")\n````\nIt returns a class of the type 'clojure.core.matrix.impl.dataset' which is used as well by Incanter.\nSo all methods from Incanter, which take a dataset should work with it.\n\n\n## License\n\nCopyright (c) 2014 Carsten Behring\n\nDistributed under the Eclipse Public License either version 1.0 or (at\nyour option) any later version.\n", 
  "id": 25047981
}